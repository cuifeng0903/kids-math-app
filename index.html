<!doctype html>
<html lang="ja">
<head>
  <!-- å…ƒä»•æ§˜æº–æ‹ ã®headï¼šãƒ¡ã‚¿ãƒ»ãƒªãƒ³ã‚¯ã®ã¿ï¼æœ¬æ–‡ãƒ†ã‚­ã‚¹ãƒˆã¯bodyå´ -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ã¿ã‚“ãªã®ã•ã‚“ã™ã† - ãŸã—ã–ã‚“ãƒ»ã²ãã–ã‚“</title>

  <!-- PWAï¼ˆ/kids-math-app/å‰æï¼‰ -->
  <meta name="theme-color" content="#0b2340" />
  /kids-math-app/manifest.webmanifest

  <!-- ã‚¢ã‚¤ã‚³ãƒ³ï¼ˆå­˜åœ¨ã™ã‚Œã°èª­ã¿è¾¼ã¾ã‚Œã¾ã™ï¼‰ -->
  /kids-math-app/apple-touch-icon.png
  /kids-math-app/icon-192.png
  /kids-math-app/icon-512.png

  <style>
    :root {
      --bg:#fff; --panel:#fafafa; --border:#eee; --text:#333;
      --primary:#2e6df6; --accent:#ff6b6b; --sum:#fedb7a; --sumBorder:#f9c94c;
      --aColor:#ffd5d5; --aBorder:#ffb3b3;
      --bColor:#d5ecff; --bBorder:#b3dbff;
      --ansColor:#fedb7a; --ansBorder:#f9c94c;
    }
    * { box-sizing: border-box; }
    body { margin:0; font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Hiragino Kaku Gothic ProN","Noto Sans JP",sans-serif; color:var(--text); background:var(--bg); }
    header { background:#0b2340; color:#fff; }
    .wrap { max-width:980px; margin:0 auto; padding:16px 20px; }

    /* ä¸Šéƒ¨äºŒæ®µãƒ‘ãƒãƒ« */
    .panel { background:var(--panel); border:1px solid var(--border); border-radius:12px; padding:12px; margin-top:12px; }
    .row { display:grid; gap:12px; }
    .row.top { grid-template-columns: auto 1fr auto auto; align-items:end; }
    .row.second { grid-template-columns: auto 1fr auto 80px; align-items:end; }
    .tabs { display:inline-flex; gap:8px; }
    .tab { border:1px solid #ddd; background:#fff; border-radius:8px; padding:8px 12px; font-weight:700; cursor:pointer; }
    .tab.is-active { background:#fff2f2; border-color:var(--accent); color:#d63a3a; }
    .label { font-size:12px; color:#666; margin-bottom:4px; display:block; }
    select { width:100%; padding:8px 10px; border:1px solid #ddd; border-radius:8px; background:#fff; }
    .btn { border:1px solid #ddd; background:#fff; border-radius:10px; padding:8px 14px; font-weight:700; cursor:pointer; }
    .btn:disabled { opacity:.5; cursor:not-allowed; }
    .btn-primary { background:var(--primary); border-color:var(--primary); color:#fff; }
    .btn-accent { background:var(--accent); border-color:var(--accent); color:#fff; }
    .btn-ghost { background:#fff; }

    /* è¡¨ç¤ºé ˜åŸŸï¼ˆç¸¦é…ç½®ï¼šA / B / ã“ãŸãˆï¼‰ */
    .board { margin-top:14px; border:1px dashed #e8e8e8; border-radius:12px; padding:12px; }
    .col { margin-bottom:12px; }
    .heading { font-size:12px; color:#666; margin:6px 0; }
    .val { margin-top:6px; font-weight:800; }
    .blocks {
      display:grid; grid-template-columns:repeat(10, 22px); gap:4px 4px; min-height:30px;
      align-items:center;
    }
    .blk {
      width:22px; height:22px; border-radius:4px; background:var(--aColor); border:1px solid var(--aBorder);
      box-shadow:0 1px 0 rgba(0,0,0,.05) inset;
      transform: translate(0,0); transition: transform .25s ease, opacity .15s ease;
    }
    .blk.A { background:var(--aColor); border-color:var(--aBorder); }
    .blk.B { background:var(--bColor); border-color:var(--bBorder); }
    .blk.S { background:var(--ansColor); border-color:var(--ansBorder); }
    .blk.fade { opacity: .15; }
    .blk.dot { outline:2px dotted currentColor; outline-offset:-2px; }
    .mark10, .mark20 {
      width:2px; height:22px; background:#bbb; justify-self:center;
    }

    .formula { text-align:center; font-weight:800; font-size:16px; letter-spacing:.02em; }
    .result { min-height:22px; margin-top:6px; font-weight:700; }
    .result.ok { color:#d63a3a; } /* èµ¤ã€‡ */
    .result.ng { color:#666; }

    .reward { display:grid; grid-template-columns: 120px auto; gap:12px; align-items:start; margin-top:12px; }
    .stamp-box { width:120px; min-height:80px; border:2px dashed #ccc; border-radius:10px; display:grid; place-items:center; color:#bbb; font-size:24px; }
    .yay-col { display:flex; flex-direction:column; gap:8px; align-items:flex-start; }
    .yay-btn { writing-mode: vertical-rl; text-orientation: mixed; }

    @media (max-width:760px) {
      .row.top { grid-template-columns: 1fr 1fr 1fr auto; }
      .row.second { grid-template-columns: 1fr 1fr auto 80px; }
      .blocks { grid-template-columns:repeat(10, 20px); }
      .blk { width:20px; height:20px; }
    }
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <h1 style="margin:0;">ã¿ã‚“ãªã®ã•ã‚“ã™ã† <small style="font-size:12px;color:#cbd2ff;margin-left:.5em;">Ver.1.1.3 Fix2</small></h1>
      <div>ãŸã—ã–ã‚“ãƒ»ã²ãã–ã‚“ï¼ˆå…ƒä»•æ§˜æº–æ‹ ï¼ä¸¡UIçµ±åˆï¼‰</div>
    </div>
  </header>

  <main class="wrap">
    <!-- ä¸Šæ®µï¼šæ¼”ç®—ã‚¿ãƒ–ï¼‹æ•°æŒ‡å®šï¼‹ã‚¹ã‚¿ãƒ¼ãƒˆ -->
    <section class="panel">
      <div class="row top">
        <div class="tabs" role="tablist" aria-label="æ¼”ç®—">
          <button class="tab is-active" id="tabAdd" data-op="add" role="tab" aria-selected="true">ãŸã—ã–ã‚“</button>
          <button class="tab" id="tabSub" data-op="sub" role="tab" aria-selected="false">ã²ãã–ã‚“</button>
        </div>

        <div>
          <label for="firstNum" class="label">ã¯ã˜ã‚ã®ã‹ãš</label>
          <select id="firstNum"></select>
        </div>
        <div>
          <label for="secondNum" class="label">ã¤ãã®ã‹ãš</label>
          <select id="secondNum"></select>
        </div>

        <div style="display:flex; align-items:end;">
          <button id="btnStart" class="btn btn-primary">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
        </div>
      </div>

      <!-- äºŒæ®µç›®ï¼šå‡ºé¡Œã‚¿ã‚¤ãƒ—ï¼‹é›£æ˜“åº¦ï¼‹ğŸ‘‘ãƒãƒ£ãƒ¬ãƒ³ã‚¸ï¼‹ã‚„ã£ãŸã­ï¼ -->
      <div class="row second" style="margin-top:10px;">
        <div>
          <label for="mode" class="label">å‡ºé¡Œã‚¿ã‚¤ãƒ—</label>
          <select id="mode">
            <option value="normal" selected>ãµã¤ã†</option>
            <option value="challenge">ğŸ‘‘ãƒãƒ£ãƒ¬ãƒ³ã‚¸</option>
          </select>
        </div>
        <div>
          <label for="difficulty" class="label">é›£æ˜“åº¦</label>
          <select id="difficulty">
            <option value="easy">ã‚„ã•ã—ã„ï¼ˆ1ã€œ10ï¼‰</option>
            <option value="normal" selected>ãµã¤ã†ï¼ˆ1ã€œ20ï¼‰</option>
            <option value="hard">ã‚€ãšã‹ã—ã„ï¼ˆ1ã€œ50ï¼‰</option>
          </select>
        </div>

        <div style="display:flex; align-items:end;">
          <button id="btnChallenge" class="btn btn-ghost">ğŸ‘‘ ãƒãƒ£ãƒ¬ãƒ³ã‚¸</button>
        </div>

        <div class="yay-col">
          <button id="btnYay" class="btn btn-accent yay-btn" title="ã‚„ã£ãŸã­ï¼">ã‚„ã£ãŸã­ï¼</button>
        </div>
      </div>
    </section>

    <!-- è¡¨ç¤ºé ˜åŸŸï¼ˆç¸¦é…ç½®ï¼šA / B / ã“ãŸãˆï¼‰ -->
    <section class="board" aria-live="polite">
      <div class="col">
        <h2 class="heading">ã¯ã˜ã‚ã®ã‹ãš</h2>
        <div id="laneA" class="blocks" data-lane="A"></div>
        <div class="val"><span id="valA">0</span></div>
      </div>

      <div class="col">
        <h2 class="heading">ã¤ãã®ã‹ãš</h2>
        <div id="laneB" class="blocks" data-lane="B"></div>
        <div class="val"><span id="valB">0</span></div>
      </div>

      <div class="col">
        <h2 class="heading">ã“ãŸãˆ</h2>
        <div id="laneAns" class="blocks" data-lane="ANS"></div>
        <div class="val">
          <select id="answer" disabled></select>
          <button id="btnCheck" class="btn btn-accent" disabled>ã“ãŸãˆã‚ã‚ã›</button>
        </div>
        <div id="msg" class="result"></div>
      </div>

      <!-- æ•°å¼è¡¨ç¤º -->
      <div class="formula" style="margin-top:8px;">
        <span id="fA">0</span>
        <span id="fOp">ï¼‹</span>
        <span id="fB">0</span>
        <span>ï¼</span>
        <span id="fQ">ï¼Ÿ</span>
      </div>
    </section>

    <!-- ã”ã»ã†ã³ -->
    <section class="reward">
      <div id="stampBox" class="stamp-box" aria-label="ã”ã»ã†ã³ã‚¹ã‚¿ãƒ³ãƒ—">â€”</div>
      <div>
        <p style="margin:0;color:#666;font-size:13px;">æ­£è§£ã™ã‚‹ã¨ã‚¹ã‚¿ãƒ³ãƒ—ãŒå¢—ãˆã‚‹ã‚ˆï¼</p>
      </div>
    </section>
  </main>

  <footer class="wrap" style="padding:16px; border-top:1px solid #eee; color:#666; font-size:13px;">
    &copy; ã¿ã‚“ãªã®ã•ã‚“ã™ã†
  </footer>

  <script>
    // ====== å‚ç…§ ======
    const $ = (s,el=document)=>el.querySelector(s);
    const $$ = (s,el=document)=>[...el.querySelectorAll(s)];
    const tabAdd=$('#tabAdd'), tabSub=$('#tabSub');
    const firstNum=$('#firstNum'), secondNum=$('#secondNum'), modeSel=$('#mode'), diffSel=$('#difficulty');
    const btnStart=$('#btnStart'), btnChallenge=$('#btnChallenge'), btnYay=$('#btnYay');
    const laneA=$('#laneA'), laneB=$('#laneB'), laneAns=$('#laneAns');
    const valA=$('#valA'), valB=$('#valB');
    const ansSel=$('#answer'), btnCheck=$('#btnCheck'), msg=$('#msg');
    const fA=$('#fA'), fB=$('#fB'), fOp=$('#fOp'), fQ=$('#fQ');

    // ====== çŠ¶æ…‹ ======
    const BASE='/kids-math-app/';
    const DIFF_MAX={easy:10, normal:20, hard:50};
    let op='add'; let A=0; let B=0;
    const answeredSet=new Set(); // é‡è¤‡ãªã—åˆ¶å¾¡

    // ====== ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ======
    const sleep = (ms)=>new Promise(r=>setTimeout(r, ms));
    function currentMax(){ return DIFF_MAX[diffSel.value] || 20; }
    function setOperator(k){ op=k; fOp.textContent = (k==='add') ? 'ï¼‹' : 'ï¼'; }
    function leftJustify(el){ /* gridãªã®ã§ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå·¦è©°ã‚ */ }
    function problemKey(a,b,op){
      if(op==='add'){ const s=[a,b].sort((x,y)=>x-y); return `add:${s[0]},${s[1]}`; }
      return `sub:${a},${b}`;
    }
    function correct(){ return op==='add' ? (A+B) : (A-B); }

    // 10/20ã¾ã¨ã¾ã‚Šãƒãƒ¼ã‚¯ï¼ˆã‚¬ã‚¤ãƒ‰ç½«ç·šï¼‰
    function addGroupMarks(el, n){
      // 10ã¨20ã®ä½ç½®ã«ã‚¬ã‚¤ãƒ‰ï¼ˆãƒãƒ¼ã‚¯ï¼‰ã‚’å·®ã—è¾¼ã‚€
      const colCount=10;
      const idx10 = 10; const idx20 = 20;
      const need10 = n >= idx10, need20 = n >= idx20;
      if(need10){ const m=document.createElement('div'); m.className='mark10'; el.insertBefore(m, el.children[idx10-1]?.nextSibling || null); }
      if(need20){ const m=document.createElement('div'); m.className='mark20'; el.insertBefore(m, el.children[idx20-1]?.nextSibling || null); }
    }

    // ãƒ–ãƒ­ãƒƒã‚¯ä½œæˆ
    function makeBlock(cls){ const d=document.createElement('div'); d.className=`blk ${cls}`; return d; }
    function renderBlocks(el, n, cls){
      el.innerHTML='';
      for(let i=0;i<n;i++){ el.appendChild(makeBlock(cls)); }
      addGroupMarks(el, n);
    }

    function updateFormula(show=false){
      fA.textContent=A; fB.textContent=B; fQ.textContent=show?correct():'ï¼Ÿ';
    }
    function applyValues(){
      valA.textContent=A; valB.textContent=B;
      renderBlocks(laneA, A, 'A');
      renderBlocks(laneB, B, 'B');
      renderBlocks(laneAns, 0, 'S');
      updateFormula(false);
      msg.textContent=''; msg.className='result';
      leftJustify(laneA); leftJustify(laneB); leftJustify(laneAns);
    }

    function fillSelects(){
      [firstNum, secondNum, ansSel].forEach(s=>s.innerHTML='');
      const max=currentMax();
      for(let i=0;i<=max;i++){
        firstNum.appendChild(new Option(String(i), String(i)));
        secondNum.appendChild(new Option(String(i), String(i)));
      }
      ansSel.appendChild(new Option('ï¼Ÿ','',true,true));
      ansSel.disabled=true; btnCheck.disabled=true;
    }

    function buildChoices(){
      const c=correct();
      const max=Math.max(currentMax(), Math.max(A,B)+5);
      const deltas=[-3,-2,-1,1,2,3,4,5,6];
      const set=new Set([c]);
      while(set.size<6){
        const base=c+deltas[Math.floor(Math.random()*deltas.length)];
        set.add(Math.max(0, Math.min(max, base)));
      }
      const arr=[...set].sort((x,y)=>x-y);
      ansSel.innerHTML=''; ansSel.appendChild(new Option('ï¼Ÿ','',true,true));
      arr.forEach(n=>ansSel.appendChild(new Option(String(n), String(n))));
      ansSel.disabled=true; btnCheck.disabled=true;
      updateFormula(false);
    }

    // ====== ãŸã—ã–ã‚“ã‚¢ãƒ‹ãƒ¡ï¼ˆå…ƒä»•æ§˜ï¼‰ ======
    async function animateAddition(){
      // Aå·¦ã‹ã‚‰â†’ç›´å‰ãƒ–ãƒ­ãƒƒã‚¯å³éš£ã¸æ­£ç¢ºç§»å‹•ï¼ˆ1ã¤ãšã¤ï¼‰
      for(let i=0;i<A;i++){
        const a = laneA.children[0]; if(!a) break;
        a.style.transform='translate(0, -28px)'; await sleep(90);
        a.remove();
        const s = makeBlock('S'); laneAns.appendChild(s); leftJustify(laneAns);
      }
      leftJustify(laneA);

      // 500msé…å»¶
      await sleep(500);

      // æ¬¡ã«Bå·¦ã‹ã‚‰â†’å³éš£ã€ç§»å‹•å…ƒã¯æ¶ˆå»ã—ã¦å·¦è©°ã‚
      for(let i=0;i<B;i++){
        const b = laneB.children[0]; if(!b) break;
        b.style.transform='translate(0, -28px)'; await sleep(90);
        b.remove();
        const s = makeBlock('S'); laneAns.appendChild(s); leftJustify(laneAns);
      }
      leftJustify(laneB);

      // å®Œäº†å¾Œåˆè¨ˆè‰²ï¼ˆSã¯æ—¢ã«åˆè¨ˆè‰²ï¼‰ã€A/Bå†è¡¨ç¤ºã‚’500msé…å»¶
      await sleep(500);
      renderBlocks(laneA, A, 'A'); renderBlocks(laneB, B, 'B'); leftJustify(laneA); leftJustify(laneB);
    }

    // ====== ã²ãã–ã‚“ã‚¢ãƒ‹ãƒ¡ï¼ˆå…ƒä»•æ§˜ï¼‰ ======
    async function animateSubtraction(){
      // é–‹å§‹ç›´å¾Œï¼šAå…¨æ•°ã‚’ä¸€åº¦ã«ã“ãŸãˆæ¬„ã¸ç§»å‹•ï¼ˆå…ƒè‰²ãƒ»å…ƒã¯æ¶ˆå»/å·¦è©°ã‚ï¼‰
      laneA.querySelectorAll('.blk').forEach(b=>b.classList.add('fade'));
      await sleep(160);
      laneA.innerHTML='';
      for(let i=0;i<A;i++){ laneAns.appendChild(makeBlock('S')); }
      leftJustify(laneAns);

      // Bå·¦ã‹ã‚‰é †ã«ã“ãŸãˆæ¬„å³ç«¯ã¸é‡ã­ã¦ä¸¡æ–¹æ¶ˆå»ï¼ˆç‚¹ç·šæ ã‚’ä¸€ç¬è¡¨ç¤ºï¼‰
      for(let i=0;i<B;i++){
        await sleep(120);
        const ansBlocks=[...laneAns.children];
        const last=ansBlocks[ansBlocks.length-1]; // å³ç«¯
        if(last){ last.classList.add('dot'); await sleep(100); last.remove(); }
        const bblk=laneB.children[0]; if(bblk){ bblk.remove(); }
      }
      leftJustify(laneB); leftJustify(laneAns);

      // çµæœè‰²ã¸åˆ‡æ›¿ï¼ˆSã®ã¾ã¾ï¼‰ã€A/Bå†è¡¨ç¤º
      renderBlocks(laneA, A, 'A'); renderBlocks(laneB, B, 'B'); leftJustify(laneA); leftJustify(laneB);
    }

    // ====== ç´™å¹é›ªï¼ˆå…¨ç”»é¢ï¼‰ ======
    function confetti(){
      const box=document.createElement('div'); Object.assign(box.style,{position:'fixed',inset:'0',pointerEvents:'none',zIndex:'9999'}); document.body.appendChild(box);
      const count=120;
      for(let i=0;i<count;i++){
        const p=document.createElement('i');
        const size=Math.random()*8+5;
        Object.assign(p.style,{
          position:'absolute', left:(Math.random()*100)+'vw', top:'-10px',
          width:size+'px', height:size+'px',
          background:`hsl(${Math.random()*360},90%,60%)`,
          transform:`rotate(${Math.random()*360}deg)`,
          borderRadius:'2px', opacity:'0.95',
          transition:'transform 1.4s linear, top 1.4s linear, opacity .25s ease-out'
        });
        box.appendChild(p);
        requestAnimationFrame(()=>{
          p.style.top=(Math.random()*100+10)+'vh';
          p.style.transform=`translateY(0) rotate(${Math.random()*720}deg)`;
        });
      }
      setTimeout(()=>box.remove(), 1600);
    }

    // ====== ã‚¤ãƒ™ãƒ³ãƒˆ ======
    tabAdd.addEventListener('click', ()=>{ tabAdd.classList.add('is-active'); tabSub.classList.remove('is-active'); setOperator('add'); applyValues(); });
    tabSub.addEventListener('click', ()=>{ tabSub.classList.add('is-active'); tabAdd.classList.remove('is-active'); setOperator('sub'); applyValues(); });

    diffSel.addEventListener('change', ()=>{ fillSelects(); A=Math.min(A, currentMax()); B=Math.min(B, currentMax()); firstNum.value=String(A); secondNum.value=String(B); applyValues(); });
    firstNum.addEventListener('change', ()=>{ A=Number(firstNum.value); valA.textContent=A; renderBlocks(laneA,A,'A'); leftJustify(laneA); updateFormula(false); });
    secondNum.addEventListener('change', ()=>{ B=Number(secondNum.value); valB.textContent=B; renderBlocks(laneB,B,'B'); leftJustify(laneB); updateFormula(false); });

    btnStart.addEventListener('click', ()=>{
      // é‡è¤‡å›é¿ï¼ˆãƒãƒ£ãƒ¬ãƒ³ã‚¸æ™‚ã«ã‚‚åŠ¹ãï¼‰ï¼šåŒä¸€å•é¡Œãªã‚‰ãƒ©ãƒ³ãƒ€ãƒ å†å‡ºé¡Œ
      const key=problemKey(A,B,op);
      if(answeredSet.has(key)){
        const max=currentMax();
        if(op==='add'){ A=Math.floor(Math.random()*(max+1)); B=Math.floor(Math.random()*(max+1)); }
        else { const x=Math.floor(Math.random()*(max+1)), y=Math.floor(Math.random()*(max+1)); A=Math.max(x,y); B=Math.min(x,y); }
        firstNum.value=String(A); secondNum.value=String(B);
      }
      applyValues(); buildChoices();
    });

    btnChallenge.addEventListener('click', ()=>{
      modeSel.value='challenge';
      const max=currentMax();
      if(op==='add'){ A=Math.floor(Math.random()*(max+1)); B=Math.floor(Math.random()*(max+1)); }
      else { const x=Math.floor(Math.random()*(max+1)), y=Math.floor(Math.random()*(max+1)); A=Math.max(x,y); B=Math.min(x,y); }
      firstNum.value=String(A); secondNum.value=String(B);
      applyValues(); buildChoices();
    });

    ansSel.addEventListener('change', ()=>{ btnCheck.disabled = (ansSel.value===''); });

    btnCheck.addEventListener('click', async ()=>{
      const val=Number(ansSel.value);
      const c=correct();
      if(Number.isNaN(val)) return;

      if(val===c){
        // å…ƒä»•æ§˜ã®ã‚¢ãƒ‹ãƒ¡
        if(op==='add'){ await animateAddition(); }
        else { await animateSubtraction(); }

        msg.textContent='ğŸ…¾ ã›ã„ã‹ã„ï¼'; msg.className='result ok';
        $('#stampBox').textContent='â­ï¸';
        confetti();

        // ğŸ‘‘ãƒãƒ£ãƒ¬ãƒ³ã‚¸æ™‚ã¯3ç§’å¾Œã«è‡ªå‹•æ¬¡ã¸
        const isChallenge = (modeSel.value==='challenge');
        answeredSet.add(problemKey(A,B,op));
        updateFormula(true);
        if(isChallenge){ setTimeout(()=>btnChallenge.click(), 3000); }
      } else {
        msg.textContent='ã‚‚ã†ã„ã¡ã©ï¼'; msg.className='result ng';
        // å†å…¥åŠ›å¯ï¼ˆãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ã®ã¾ã¾ï¼‰
      }
    });

    btnYay.addEventListener('click', ()=>{
      // ã”ã»ã†ã³ã‚’æ˜ç¤ºçš„ã«æŠ¼ã—ãŸã¨ãã®å°ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
      confetti();
    });

    // ====== åˆæœŸåŒ– ======
    (function init(){
      setOperator('add');
      fillSelects();
      A=3; B=2;
      firstNum.value='3'; secondNum.value='2';
      applyValues();
    })();

    // ====== Service Worker ç™»éŒ²ï¼ˆ/kids-math-app/ ã‚¹ã‚³ãƒ¼ãƒ—ï¼‰ ======
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', async ()=>{
        try { await navigator.serviceWorker.register('./sw.js', { scope: BASE }); }
        catch(e){ /* ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã®ã¿å‹•ä½œã§ã‚‚OK */ }
      });
    }
  </script>
</body>
</html>
