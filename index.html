<!doctype html>
<html lang="ja">
<head>
  <!-- æ­£è¦åŒ–æ¸ˆã¿ headï¼šäººãŒèª­ã‚€æœ¬æ–‡ã¯ body å´ï¼ãƒ¡ã‚¿ãƒ»ãƒªãƒ³ã‚¯ã®ã¿ -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ã¿ã‚“ãªã®ã•ã‚“ã™ã† - ãŸã—ã–ã‚“ãƒ»ã²ãã–ã‚“</title>

  <!-- PWA -->
  <meta name="theme-color" content="#0b2340" />
  /kids-math-app/manifest.webmanifest

  <!-- ä¸»è¦ã‚¢ã‚¤ã‚³ãƒ³ï¼ˆå­˜åœ¨ã™ã‚Œã°ä½¿ç”¨ï¼‰ -->
  /kids-math-app/apple-touch-icon.png
  /kids-math-app/icon-192.png
  /kids-math-app/icon-512.png

  <style>
    :root { --accent:#ff6b6b; --primary:#2e6df6; --bg:#fafafa; --border:#eee; --text:#333; --sum:#fedb7a; --sumBorder:#f9c94c; }
    body { margin:0; font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Hiragino Kaku Gothic ProN","Noto Sans JP",sans-serif; color:var(--text); background:#fff; }
    header { padding: 16px; background: #0b2340; color: #fff; }
    main { padding: 16px; }

    .km-container { max-width: 980px; margin: 0 auto; }
    .km-title { font-size:22px; font-weight:700; }
    .km-title small { font-size: 12px; color: #cbd2ff; margin-left: .5em; }

    .km-panel { background: var(--bg); border: 1px solid var(--border); border-radius: 10px; padding: 12px; margin-top:16px; }
    .km-ops-tabs { display:inline-flex; gap:8px; margin-bottom:10px; }
    .km-tab { border:1px solid #ddd; background:#fff; border-radius:8px; padding:8px 12px; cursor:pointer; font-weight:600; }
    .km-tab.is-active { background:#fff2f2; border-color:var(--accent); color:#d63a3a; }
    .km-settings { display:grid; grid-template-columns:repeat(4,minmax(0,1fr)); gap:12px; align-items:end; }
    .km-setting label { display:block; font-size:12px; color:#666; margin-bottom:4px; }
    .km-select { width:100%; padding:8px 10px; border:1px solid #ddd; border-radius:8px; background:#fff; }
    .km-actions { display:flex; gap:8px; justify-content:flex-end; }
    .km-btn { border:1px solid #ddd; background:#fff; border-radius:10px; padding:8px 14px; font-weight:700; cursor:pointer; }
    .km-btn:disabled { opacity:.5; cursor:not-allowed; }
    .km-btn-primary { background:var(--primary); border-color:var(--primary); color:#fff; }
    .km-btn-accent { background:var(--accent); border-color:var(--accent); color:#fff; }
    .km-btn-ghost { background:#fff; color:#333; }

    .km-board { margin-top:14px; border:1px dashed #e8e8e8; border-radius:10px; padding:12px; }
    .km-row { display:grid; grid-template-columns:1fr 60px 1fr 40px 1fr; gap:8px; align-items:start; }
    .km-col { min-width:0; }
    .km-col-operator,.km-col-equals { display:flex; align-items:center; justify-content:center; }
    .km-label { font-size:12px; color:#666; margin:6px 0; }
    .km-operator { font-size:24px; font-weight:900; color:var(--accent); }
    .km-equals { font-size:20px; font-weight:900; color:#333; }
    .km-value { text-align:center; margin-top:6px; color:#333; }
    .km-num { font-weight:800; font-size:16px; }

    .km-blocks { display:grid; grid-template-columns:repeat(10, 20px); gap:4px 4px; min-height:28px; }
    .blk { width:20px; height:20px; border-radius:4px; background:#ffd5d5; border:1px solid #ffb3b3; box-shadow:0 1px 0 rgba(0,0,0,.04) inset; transform: translate(0,0); transition: transform .28s ease, opacity .18s ease; }
    .blk.bA { background:#ffd5d5; border-color:#ffb3b3; }
    .blk.bB { background:#d5ecff; border-color:#b3dbff; }
    .blk.bSum { background:var(--sum); border-color:var(--sumBorder); }
    .blk.fade { opacity: .15; }
    .blk.dot-outline { outline: 2px dotted #888; outline-offset: -2px; }

    .km-answer { display:flex; gap:8px; align-items:center; margin-top:6px; }
    .km-answer-select { min-width:120px; }

    .km-result { min-height:20px; margin-top:6px; font-weight:700; }
    .km-result.ok { color:#d63a3a; }  /* èµ¤ã€‡ã‚¤ãƒ¡ãƒ¼ã‚¸ */
    .km-result.ng { color:#666; }

    .km-formula { margin-top:10px; text-align:center; font-weight:800; font-size:16px; letter-spacing:.02em; }

    .km-reward-area { margin-top:12px; display:flex; gap:12px; align-items:center; }
    .km-stamps { display:flex; gap:8px; align-items:center; }
    .km-stamp-slot { width:56px; height:56px; border:2px dashed #ccc; border-radius:12px; display:grid; place-items:center; color:#bbb; }

    /* å°ç”»é¢ */
    @media (max-width:720px){
      .km-settings{grid-template-columns:1fr 1fr;}
      .km-row{grid-template-columns:1fr 40px 1fr 30px 1fr;}
      .km-blocks{grid-template-columns:repeat(10, 18px);}
      .blk{width:18px; height:18px;}
    }
  </style>
</head>
<body>
  <header>
    <div class="km-container">
      <h1 class="km-title">ã¿ã‚“ãªã®ã•ã‚“ã™ã† <small>Ver.1.1.3 Fix2</small></h1>
      <div>ãŸã—ã–ã‚“ãƒ»ã²ãã–ã‚“ï¼ˆä¸¡UIçµ±åˆï¼‰</div>
    </div>
  </header>

  <main class="km-container">
    <!-- æ“ä½œãƒ‘ãƒãƒ« -->
    <section class="km-panel">
      <div class="km-ops-tabs" role="tablist" aria-label="æ¼”ç®—ã®é¸æŠ">
        <button class="km-tab is-active" data-op="add" role="tab" aria-selected="true">ãŸã—ã–ã‚“</button>
        <button class="km-tab" data-op="sub" role="tab" aria-selected="false">ã²ãã–ã‚“</button>
      </div>

      <div class="km-settings">
        <div class="km-setting">
          <label for="firstNum">ã¯ã˜ã‚ã®ã‹ãš</label>
          <select id="firstNum" class="km-select"></select>
        </div>
        <div class="km-setting">
          <label for="secondNum">ã¤ãã®ã‹ãš</label>
          <select id="secondNum" class="km-select"></select>
        </div>
        <div class="km-setting">
          <label for="difficulty">é›£æ˜“åº¦</label>
          <select id="difficulty" class="km-select">
            <option value="easy">ã‚„ã•ã—ã„ï¼ˆ1ã€œ10ï¼‰</option>
            <option value="normal" selected>ãµã¤ã†ï¼ˆ1ã€œ20ï¼‰</option>
            <option value="hard">ã‚€ãšã‹ã—ã„ï¼ˆ1ã€œ50ï¼‰</option>
          </select>
        </div>
        <div class="km-actions">
          <button id="btnStart" class="km-btn km-btn-primary">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
          <button id="btnReset" class="km-btn" disabled>ã‚„ã‚ŠãªãŠã—</button>
        </div>
      </div>
    </section>

    <!-- è¡¨ç¤ºé ˜åŸŸ -->
    <section class="km-board" aria-live="polite" aria-atomic="true">
      <div class="km-row">
        <div class="km-col">
          <h2 class="km-label">ã¯ã˜ã‚ã®ã‹ãš</h2>
          <div id="laneA" class="km-blocks" data-lane="A"></div>
          <div class="km-value"><span id="valueA" class="km-num">0</span></div>
        </div>

        <div class="km-col km-col-operator">
          <div id="opBadge" class="km-operator">ï¼‹</div>
        </div>

        <div class="km-col">
          <h2 class="km-label">ã¤ãã®ã‹ãš</h2>
          <div id="laneB" class="km-blocks" data-lane="B"></div>
          <div class="km-value"><span id="valueB" class="km-num">0</span></div>
        </div>

        <div class="km-col km-col-equals">
          <div class="km-equals">ï¼</div>
        </div>

        <div class="km-col">
          <h2 class="km-label">ã“ãŸãˆ</h2>
          <div id="laneAns" class="km-blocks km-blocks-answer" data-lane="ANS"></div>
          <div class="km-answer">
            <select id="answer" class="km-select km-answer-select" disabled></select>
            <button id="btnCheck" class="km-btn km-btn-accent" disabled>ã“ãŸãˆã‚ã‚ã›</button>
          </div>
          <div id="resultMsg" class="km-result" role="status"></div>
        </div>
      </div>

      <div class="km-formula">
        <span id="fA">0</span>
        <span id="fOp">ï¼‹</span>
        <span id="fB">0</span>
        <span>ï¼</span>
        <span id="fQ">ï¼Ÿ</span>
      </div>
    </section>

    <!-- ãƒãƒ£ãƒ¬ãƒ³ã‚¸ï¼†ã‚¹ã‚¿ãƒ³ãƒ— -->
    <section class="km-reward-area">
      <button id="btnChallenge" class="km-btn km-btn-ghost" title="ãƒ©ãƒ³ãƒ€ãƒ å‡ºé¡Œï¼ˆã‹ã‚“ã‚€ã‚Šãƒãƒ£ãƒ¬ãƒ³ã‚¸ï¼‰">ğŸ‘‘ ãƒãƒ£ãƒ¬ãƒ³ã‚¸</button>
      <div class="km-stamps">
        <div class="km-stamp-slot" aria-label="ã”ã»ã†ã³ã‚¹ã‚¿ãƒ³ãƒ—"></div>
      </div>
    </section>

    <!-- è‡ªå‹•ãƒã‚§ãƒƒã‚¯ã®ç°¡æ˜“ãƒ¬ãƒãƒ¼ãƒˆ -->
    <section id="autoCheck" class="km-panel" style="margin-top:12px;">
      <div><strong>è‡ªå‹•ãƒã‚§ãƒƒã‚¯</strong></div>
      <ul id="autoCheckLog" style="margin:6px 0 0 16px;"></ul>
    </section>
  </main>

  <footer class="km-container" style="padding:16px; border-top:1px solid #eee; color:#666; font-size:13px;">
    &copy; ã¿ã‚“ãªã®ã•ã‚“ã™ã†
  </footer>

  <script>
    // ====== å‚ç…§ ======
    const $  = (s, el=document)=>el.querySelector(s);
    const $$ = (s, el=document)=>[...el.querySelectorAll(s)];
    const firstNum=$('#firstNum'), secondNum=$('#secondNum'), difficulty=$('#difficulty');
    const tabs=$$('.km-tab'), opBadge=$('#opBadge');
    const valueA=$('#valueA'), valueB=$('#valueB'), laneA=$('#laneA'), laneB=$('#laneB'), laneAns=$('#laneAns');
    const ansSel=$('#answer'), btnStart=$('#btnStart'), btnReset=$('#btnReset'), btnCheck=$('#btnCheck'), resultMsg=$('#resultMsg');
    const btnChallenge=$('#btnChallenge'); const fA=$('#fA'), fB=$('#fB'), fOp=$('#fOp'), fQ=$('#fQ');
    const logBox=$('#autoCheckLog');

    // ====== çŠ¶æ…‹ ======
    const BASE='/kids-math-app/';
    const DIFF_MAX={easy:10, normal:20, hard:50};
    let op='add'; let A=0, B=0; const answeredSet=new Set();

    // ====== æ±ç”¨ ======
    function currentMax(){ return DIFF_MAX[difficulty.value]||20; }
    function setOperator(k){ op=k; const ch=(k==='add')?'ï¼‹':'ï¼'; opBadge.textContent=ch; fOp.textContent=ch; }
    function getCorrect(){ return op==='add'? (A+B) : (A-B); }
    function problemKey(a,b,op){ if(op==='add'){ const s=[a,b].sort((x,y)=>x-y); return `add:${s[0]},${s[1]}`; } return `sub:${a},${b}`; }

    // ====== ãƒ–ãƒ­ãƒƒã‚¯æç”»ï¼ˆå·¦è©°ã‚ï¼‰ ======
    function renderBlocks(el, n, cls){
      el.innerHTML='';
      for(let i=0;i<n;i++){ const d=document.createElement('div'); d.className=`blk ${cls}`; el.appendChild(d); }
    }
    function leftJustify(el){ /* gridãŒå·¦è©°ã‚ã®ãŸã‚ä½•ã‚‚ã—ãªã„ãŒã€å°†æ¥ãƒ•ãƒ¬ãƒƒã‚¯ã‚¹ã«å¤‰ãˆã‚‹å ´åˆã«å‚™ãˆãŸç½®æ›ãƒã‚¤ãƒ³ãƒˆ */ }

    // ====== ãƒ•ã‚©ãƒ¼ãƒŸãƒ¥ãƒ©æ›´æ–° ======
    function updateFormula(show=false){ fA.textContent=A; fB.textContent=B; fQ.textContent=show?getCorrect():'ï¼Ÿ'; }

    // ====== ã‚»ãƒ¬ã‚¯ãƒˆå……å¡« ======
    function fillNumberOptions(max){
      [firstNum, secondNum, ansSel].forEach(s=>s.innerHTML='');
      for(let i=0;i<=max;i++){
        firstNum.appendChild(new Option(String(i),String(i)));
        secondNum.appendChild(new Option(String(i),String(i)));
      }
      ansSel.appendChild(new Option('ï¼Ÿ','',true,true));
      ansSel.disabled=true; btnCheck.disabled=true;
    }

    // ====== UIæ›´æ–° ======
    function applyValues(){
      valueA.textContent=A; valueB.textContent=B;
      renderBlocks(laneA,A,'bA'); renderBlocks(laneB,B,'bB'); renderBlocks(laneAns,0,'bSum');
      leftJustify(laneA); leftJustify(laneB); leftJustify(laneAns);
      updateFormula(false);
      resultMsg.textContent=''; resultMsg.className='km-result';
    }

    // ====== å›ç­”å€™è£œ ======
    function buildChoices(){
      const correct=getCorrect(); const max=Math.max(currentMax(), Math.max(A,B)+5);
      const deltas=[-3,-2,-1,1,2,3,4,5,6]; const set=new Set([correct]);
      while(set.size<6){ const base=correct+deltas[Math.floor(Math.random()*deltas.length)]; set.add(Math.max(0,Math.min(max,base))); }
      const arr=[...set].sort((x,y)=>x-y);
      ansSel.innerHTML=''; ansSel.appendChild(new Option('ï¼Ÿ','',true,true));
      arr.forEach(n=>ansSel.appendChild(new Option(String(n),String(n))));
      ansSel.disabled=false; btnCheck.disabled=true;
    }

    // ====== ãŸã—ã–ã‚“ã‚¢ãƒ‹ãƒ¡ï¼ˆVer.1.0ä»•æ§˜ã®è¦ç‚¹ã«æ²¿ã£ãŸçµ±åˆç‰ˆï¼‰ ======
    async function animateAddition(){
      // A ã‚’å·¦ã‹ã‚‰é †ã«ã€Œã“ãŸãˆæ¬„ã€ã¸æ­£ç¢ºã«ç§»å‹• â†’ å…ƒã¯æ¶ˆå»ã—ã¦å·¦è©°ã‚
      const aBlocks=[...laneA.children];
      for(let i=0;i<aBlocks.length;i++){
        const blk=aBlocks[i];
        blk.style.transform='translate(0, -26px)';
        await new Promise(r=>setTimeout(r, 80));
        blk.remove();
        const sum = document.createElement('div'); sum.className='blk bSum'; laneAns.appendChild(sum);
      }
      leftJustify(laneA); leftJustify(laneAns);

      // 500ms é…å»¶ã®ã®ã¡ B ã‚’å·¦ã‹ã‚‰é †ã«åŒæ§˜ã«ç§»å‹•
      await new Promise(r=>setTimeout(r, 500));
      const bBlocks=[...laneB.children];
      for(let i=0;i<bBlocks.length;i++){
        const blk=bBlocks[i];
        blk.style.transform='translate(0, -26px)';
        await new Promise(r=>setTimeout(r, 80));
        blk.remove();
        const sum = document.createElement('div'); sum.className='blk bSum'; laneAns.appendChild(sum);
      }
      leftJustify(laneB); leftJustify(laneAns);
    }

    // ====== ã²ãã–ã‚“ã‚¢ãƒ‹ãƒ¡ï¼ˆVer.1.0ä»•æ§˜ã®è¦ç‚¹ã«æ²¿ã£ãŸçµ±åˆç‰ˆï¼‰ ======
    async function animateSubtraction(){
      // é–‹å§‹ç›´å¾Œï¼šA ã®å…¨æ•°ã‚’ä¸€åº¦ã«ã“ãŸãˆæ¬„ã¸ç§»å‹•ï¼ˆå…ƒã¯æ¶ˆå»/å·¦è©°ã‚ï¼‰
      const aBlocks=[...laneA.children];
      aBlocks.forEach(b=>b.classList.add('fade'));
      await new Promise(r=>setTimeout(r, 160));
      laneA.innerHTML='';
      for(let i=0;i<A;i++){ const sum=document.createElement('div'); sum.className='blk bSum'; laneAns.appendChild(sum); }
      leftJustify(laneAns);

      // B ã‚’å·¦ã‹ã‚‰é †ã«ã“ãŸãˆæ¬„å³ç«¯ã¸é‡ã­ â†’ ä¸¡æ–¹æ¶ˆå»ï¼ˆç‚¹ç·šæ ã‚’ä¸€ç¬è¡¨ç¤ºï¼‰
      for(let i=0;i<B;i++){
        await new Promise(r=>setTimeout(r, 120));
        const ansBlocks=[...laneAns.children];
        const last=ansBlocks[ansBlocks.length-1];
        if(last){
          last.classList.add('dot-outline');
          await new Promise(r=>setTimeout(r, 100));
          last.remove(); // Aã®1ã¤ã‚’æ¶ˆã™
        }
        const bblk=laneB.children[0];
        if(bblk){ bblk.remove(); } // Bã®è©²å½“ãƒ–ãƒ­ãƒƒã‚¯ã‚‚æ¶ˆã™
      }
      leftJustify(laneB); leftJustify(laneAns);
    }

    // ====== ç´™å¹é›ªï¼ˆè»½é‡DOMï¼‰ ======
    function confettiMini(){
      const box=document.createElement('div'); Object.assign(box.style,{position:'fixed',inset:'0',pointerEvents:'none',zIndex:'9999'}); document.body.appendChild(box);
      const count=80; for(let i=0;i<count;i++){ const p=document.createElement('i'); const size=Math.random()*8+4;
        Object.assign(p.style,{position:'absolute',left:(Math.random()*100)+'vw',top:'-10px',width:size+'px',height:size+'px',
          background:`hsl(${Math.random()*360},90%,60%)`,transform:`rotate(${Math.random()*360}deg)`,borderRadius:'2px',opacity:'0.9',
          transition:'transform 1.2s linear, top 1.2s linear, opacity .2s ease-out' });
        box.appendChild(p);
        requestAnimationFrame(()=>{ p.style.top=(Math.random()*100+10)+'vh'; p.style.transform=`translateY(0) rotate(${Math.random()*720}deg)`; });
      } setTimeout(()=>box.remove(),1400);
    }

    // ====== ã‚¤ãƒ™ãƒ³ãƒˆæŸã­ ======
    tabs.forEach(b=>b.addEventListener('click',()=>{
      tabs.forEach(x=>x.classList.remove('is-active')); b.classList.add('is-active');
      setOperator(b.dataset.op); applyValues();
    }));
    difficulty.addEventListener('change',()=>{
      fillNumberOptions(currentMax());
      A=Math.min(A,currentMax()); B=Math.min(B,currentMax());
      firstNum.value=String(A); secondNum.value=String(B); applyValues();
    });
    firstNum.addEventListener('change',()=>{ A=Number(firstNum.value); valueA.textContent=A; renderBlocks(laneA,A,'bA'); leftJustify(laneA); updateFormula(false); });
    secondNum.addEventListener('change',()=>{ B=Number(secondNum.value); valueB.textContent=B; renderBlocks(laneB,B,'bB'); leftJustify(laneB); updateFormula(false); });

    btnStart.addEventListener('click',()=>{
      A=Number(firstNum.value); B=Number(secondNum.value);
      const key=problemKey(A,B,op);
      if(answeredSet.has(key)){
        const max=currentMax();
        if(op==='add'){ A=Math.floor(Math.random()*(max+1)); B=Math.floor(Math.random()*(max+1)); }
        else { const x=Math.floor(Math.random()*(max+1)), y=Math.floor(Math.random()*(max+1)); A=Math.max(x,y); B=Math.min(x,y); }
        firstNum.value=String(A); secondNum.value=String(B);
      }
      applyValues(); buildChoices(); btnReset.disabled=false;
    });

    btnReset.addEventListener('click',()=>{
      laneAns.innerHTML=''; ansSel.selectedIndex=0; ansSel.disabled=true; btnCheck.disabled=true;
      resultMsg.textContent=''; resultMsg.className='km-result'; updateFormula(false);
    });

    ansSel.addEventListener('change',()=>{ btnCheck.disabled=(ansSel.value===''); });

    btnCheck.addEventListener('click', async ()=>{
      const val=Number(ansSel.value), correct=getCorrect(); if(Number.isNaN(val)) return;

      // æ¼”ç®—åˆ¥ã‚¢ãƒ‹ãƒ¡
      if(val===correct){
        if(op==='add'){ await animateAddition(); }
        else { await animateSubtraction(); }
        resultMsg.textContent='ğŸ…¾ ã›ã„ã‹ã„ï¼'; resultMsg.className='km-result ok';

        // ã‚¹ã‚¿ãƒ³ãƒ— & ç´™å¹é›ª
        const slot=document.querySelector('.km-stamp-slot'); slot.textContent='â­ï¸'; confettiMini();

        // 3ç§’ã§ã¯ãªãçŸ­ç¸®ã§æ¬¡ã¸ï¼ˆUXå¼·åŒ–ï¼‰
        setTimeout(()=>btnChallenge.click(), 800);
        answeredSet.add(problemKey(A,B,op));
        updateFormula(true);
      } else {
        resultMsg.textContent='ã‚‚ã†ã„ã¡ã©ï¼'; resultMsg.className='km-result ng';
      }
    });

    btnChallenge.addEventListener('click',()=>{
      const max=currentMax();
      if(op==='add'){ A=Math.floor(Math.random()*(max+1)); B=Math.floor(Math.random()*(max+1)); }
      else { const x=Math.floor(Math.random()*(max+1)), y=Math.floor(Math.random()*(max+1)); A=Math.max(x,y); B=Math.min(x,y); }
      firstNum.value=String(A); secondNum.value=String(B); applyValues(); buildChoices(); btnReset.disabled=false;
    });

    // ====== åˆæœŸè¡¨ç¤º ======
    fillNumberOptions(currentMax());
    A=3; B=2; firstNum.value='3'; secondNum.value='2'; setOperator('add'); applyValues();

    // ====== Service Worker ç™»éŒ²ï¼ˆ/kids-math-app/ ã‚¹ã‚³ãƒ¼ãƒ—ï¼‰ ======
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', async () => {
        try {
          const reg = await navigator.serviceWorker.register('./sw.js', { scope: BASE });
          addLog(`SW: ç™»éŒ²OK scope=${reg.scope}`);
        } catch (err) {
          addLog('SW: ç™»éŒ²å¤±æ•—ï¼ˆsw.jsæœªé…ç½®ã¾ãŸã¯æ¨©é™ã‚¨ãƒ©ãƒ¼ï¼‰');
        }
      });
    } else {
      addLog('SW: éå¯¾å¿œãƒ–ãƒ©ã‚¦ã‚¶');
    }

    // ====== è‡ªå‹•ãƒã‚§ãƒƒã‚¯ï¼ˆç°¡æ˜“ï¼‰ ======
    function addLog(t){ const li=document.createElement('li'); li.textContent=t; logBox.appendChild(li); }
    (async () => {
      // manifest
      const hasManifest = !!document.querySelector('link[rel="manifest"]');
      addLog(`manifest: ${hasManifest ? 'OK' : 'ä¸è¶³'}`);

      // ã‚¢ã‚¤ã‚³ãƒ³ç–é€š
      const icons=[BASE+'apple-touch-icon.png', BASE+'icon-192.png', BASE+'icon-512.png'];
      const rs=await Promise.allSettled(icons.map(u=>fetch(u,{method:'HEAD', cache:'no-store'})));
      rs.forEach((r,i)=>addLog(`ICON ${i+1}: ${r.status==='fulfilled' && r.value.ok ? 'OK' : 'æœªæ¤œå‡º'}`));
    })();
  </script>
</body>
</html>
